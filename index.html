<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Globe</title>
    <meta itemprop="name"                                      content="Globe"/>
    <meta itemprop="description"     name="description"        content="A globe visualization project"/>
    <meta itemprop="author"          name="author"             content="Your Name"/>

    <link rel="stylesheet" href="style.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.0/backbone-min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.3.10/d3.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.geo.polyhedron.v0.min.js" charset="utf-8"></script>
    <!-- Replaced when.js with a standard Promise polyfill -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

    <!-- Original Cambecc Earth utility files -->
    <script src="./js/micro.js" charset="utf-8"></script>
    <script src="./js/globes.js" charset="utf-8"></script>
    <script src="./js/products.js" charset="utf-8"></script>

    <!-- Geomagnetism library (add your local path or CDN here) -->
    <!-- <script src="path/to/your/geomagnetism.js" charset="utf-8"></script> -->

    <!-- Your project scripts (adapted to global scope) -->
    <script src="./js/svg-globe-cambecc.js" charset="utf-8"></script>
    <script src="./js/magvar-canvas-overlay.js" charset="utf-8"></script>
    <script src="./js/app.js" charset="utf-8"></script>
    <script>
        console.log("--- Debugging when.js ---");
        console.log("Type of window.when:", typeof window.when);
        console.log("Value of window.when:", window.when);
        if (window.when && typeof window.when.defer === 'function') {
          console.log("when.js seems to be loaded correctly and exposes defer.");
        } else {
          console.error("when.js is NOT loaded correctly. \'when\' or \'when.defer\' is missing/not a function.", window.when);
        }
        console.log("--- End Debugging when.js ---");
      </script>
      
</head>
<body>

    <div id="left-sidebar">
        <ul>
            <li class="sidebar-item" data-panel="layers">Layers</li>
            <li class="sidebar-item" data-panel="settings">Settings</li>
            <li class="sidebar-item" data-panel="about">About</li>
        </ul>
    </div>

    <div id="sidebar-content">
        <div id="panel-layers" class="sidebar-content-panel">
            <div class="panel-header">
                <h3>Layers</h3>
                <button class="hide-panel-button">×</button>
            </div>
            <div class="panel-inner-content">
                <!-- Layers content here -->
                <ul>
                    <li>
                        <input checked="" id="toggle-magvar-overlay" type="checkbox"><label for="toggle-magvar-overlay">Magnetic
                            Variation</label>
                    </li>
                     <li>
                        <input id="toggle-layer-airports" type="checkbox"><label for="toggle-layer-airports">Airports</label>
                    </li>
                    <li>
                        <input id="toggle-layer-waypoints" type="checkbox"><label for="toggle-layer-waypoints">Waypoints</label>
                    </li>
                     <li>
                        <input id="toggle-layer-navaids" type="checkbox"><label for="toggle-layer-navaids">Navaids</label>
                    </li>
                </ul>

            </div>
        </div>

        <div id="panel-settings" class="sidebar-content-panel">
             <div class="panel-header">
                <h3>Settings</h3>
                <button class="hide-panel-button">×</button>
            </div>
             <div class="panel-inner-content">
                <!-- Settings content here -->
                 <div>
                    <label for="magvar-resolution">Magnetic Variation Resolution:</label>
                    <input type="range" id="magvar-resolution" name="magvar-resolution" min="1" max="20" step="1">
                </div>
                 <div>
                    <label for="magvar-year">Magnetic Variation Year:</label>
                    <input type="number" id="magvar-year" name="magvar-year" min="1900" max="2030">
                </div>
            </div>
        </div>

        <div id="panel-about" class="sidebar-content-panel">
             <div class="panel-header">
                <h3>About</h3>
                <button class="hide-panel-button">×</button>
            </div>
             <div class="panel-inner-content">
                <!-- About content here -->
                 <p>This is a globe visualization project.</p>
                 <p id="clicked-coordinates"></p>
             </div>
        </div>
    </div>

    <div id="display">
        <svg id="map" class="fill-screen"></svg>
        <canvas id="animation" class="fill-screen"></canvas>
        <canvas id="overlay" class="fill-screen"></canvas>
        <svg id="foreground" class="fill-screen"></svg>
    </div>

    <div id="details">
         <!-- Status and progress elements required by report object -->
        <p id="status"></p>
        <p id="progress" class="invisible"></p>
         <!-- Other details like location can go here if needed -->
         <!-- <div id="location">...</div> -->
         <!-- <p id="earth">...</p> -->
         <!-- <div id="menu">...</div> -->
    </div>

</body>
</html>
